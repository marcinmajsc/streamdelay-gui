# Streamdelay-GUI (hybrid): Nginx reverse proxy -> Gunicorn (127.0.0.1:8080)
# - Nginx serves static files directly (icons/CSS/JS) with caching
# - Gunicorn handles dynamic routes (/ , /status.json, POST actions)

server {
  listen 80;
  listen [::]:80;
  server_name _;

  # --- Static assets (served by nginx) ---
  location /static/ {
    alias /opt/streamgui/static/;
    access_log off;

    # Good defaults for icons/app assets
    expires 30d;
    add_header Cache-Control "public, max-age=2592000, immutable" always;
    try_files $uri =404;
  }

  # For common favicon URLs requested by browsers
  location = /favicon.ico { return 302 /static/favicon.ico; }
  location = /apple-touch-icon.png { return 302 /static/apple-touch-icon.png; }

  # --- Everything else goes to Gunicorn ---
  location / {
    proxy_pass http://127.0.0.1:8080;
    proxy_http_version 1.1;

    proxy_set_header Host              $host;
    proxy_set_header X-Real-IP         $remote_addr;
    proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;

    proxy_read_timeout  30s;
    proxy_send_timeout  30s;
  }
}
