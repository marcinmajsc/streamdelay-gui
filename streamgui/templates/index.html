<!doctype html>
<!--
Created: 2026-01-02
Author: @marcinmajsc
Repository: https://github.com/marcinmajsc/streamdelay-gui
-->

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="color-scheme" content="light dark">
  <title>Streamdelay-GUI</title>

  <!-- Icons (single clean block) -->
  <link rel="icon" type="image/svg+xml" href="/static/streamdelay-logo.svg">
  <link rel="icon" type="image/x-icon" href="/static/favicon.ico" sizes="any">
  <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon-16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon-32.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/static/favicon-192.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/static/apple-touch-icon.png">
  <link rel="manifest" href="/static/manifest.webmanifest">
  <meta name="theme-color" content="#0b0f17">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <link rel="stylesheet" href="/static/css/app.css">

  <!-- Theme bootstrap (must be in-head to avoid flash) -->
  <script>
    (function(){
      try{
        var mode = localStorage.getItem("theme_mode");
        if (mode !== "auto" && mode !== "light" && mode !== "dark") mode = "auto";
        var actual = mode;
        if (mode === "auto") {
          actual = (window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches) ? "dark" : "light";
        }
        document.documentElement.setAttribute("data-theme", actual);
      }catch(e){}
    })();
  </script>
</head>

<body>
  <div class="wrap">
    <header class="topbar">
      <div class="brand" aria-label="Streamdelay GUI">
        <img class="logo" src="/static/streamdelay-logo.svg" alt="" aria-hidden="true">
        <h1>Streamdelay-GUI</h1>
      </div>
    </header>

    {% if app_error %}
      <section class="box red" aria-label="Application error">
        <div class="srow" style="align-items:center;">
          <strong>ERROR</strong>
        </div>
        <div class="mini" style="margin-top:8px">
          <code>{{ app_error }}</code>
        </div>
      </section>
    {% endif %}

    {% if not yt_configured %}
      <section class="box red" aria-label="YouTube Stream Key required">
        <div class="ythead">
          <div><strong>YOUTUBE STREAM KEY</strong></div>
          <div class="ytpill notset">NOT SET</div>
        </div>

        <form method="post" action="/set_youtube" style="margin-top:12px" autocomplete="off">
          <input id="ytKey" name="yt_key" type="password" inputmode="text" placeholder="paste YouTube stream key here" aria-label="YouTube stream key">
          <button class="primaryBtn" type="submit" style="margin-top:10px">SAVE</button>
          <div class="mini">Clicking SAVE restarts the streamdelay service.</div>
          <div class="mini">Required before the control panel is available.</div>
        </form>
      </section>
    {% else %}

      <section class="box" aria-label="Status">
        {% if app_error %}
          <div class="mini bad" role="alert" style="font-weight:800; margin-bottom:10px">{{ app_error }}</div>
        {% endif %}

        <div class="srow">
          <div>STREAM:</div>
          <b id="streamBadge" class="bad">UNKNOWN</b>
          <span id="streamDetail"></span>
        </div>

        <div class="srow">
          <div>CENSOR:</div>
          <b id="censorBadge" class="bad">UNKNOWN</b>
          <span id="censorDetail"></span>
        </div>

        <div style="margin-top:16px">
          <div class="srow" style="justify-content:space-between">
            <div><strong>ACTIONS SAFETY DELAY</strong></div>
            <div id="toggleCountdown" style="font-weight:700;"></div>
          </div>

          <div class="pwrap" title="Safety delay before actions can run again">
            <div id="pbar" class="pbar"></div>
          </div>
        </div>
      </section>

      <section class="grid" aria-label="Controls">
        <form method="post" action="/start">
          <button id="startBtn" type="submit">START</button>
        </form>

        <form id="stopForm" method="post" action="/stop">
          <button id="stopBtn" type="submit">STOP</button>
        </form>

        <form method="post" action="/censor_on">
          <button id="censorOnBtn" type="submit">CENSOR ON</button>
        </form>

        <form method="post" action="/censor_off">
          <button id="censorOffBtn" type="submit">CENSOR OFF</button>
        </form>

        <div class="gridfull box" aria-label="YouTube Stream Key">
          <div class="ythead">
            <div><strong>YOUTUBE STREAM KEY</strong></div>
            <div class="ytpill set">SET</div>
          </div>

          <form method="post" action="/set_youtube" style="margin-top:12px" autocomplete="off">
            <input id="ytKey2" name="yt_key" type="password" inputmode="text" placeholder="Current: {{ yt_mask }}" aria-label="YouTube stream key (update)">
            <button class="primaryBtn" type="submit" style="margin-top:10px">SAVE</button>
            <div class="mini">Clicking SAVE restarts the streamdelay service.</div>
            <div class="mini">To change it, paste a new key above and save.</div>
            <div class="mini">Leave empty to clear (disable output).</div>
          </form>
        </div>
      </section>

      <section class="box" aria-label="OBS SRT output">
        <div class="obsHead">
          <div class="obsTitle">OBS (SRT output)</div>
          <button class="copyBtn" id="copyObsBtn" type="button">COPY</button>
        </div>

        <div class="obsCode" id="srtUri">srt://0.0.0.0:9000?mode=caller&latency=200000</div>

        <div class="obsHint">
          Paste this into OBS → Settings → Stream → SRT (or Custom) output URL.
          <div class="obsNoteLine">
            <span class="noteIcon" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="10" x2="12" y2="16"></line>
                <circle cx="12" cy="7" r="1"></circle>
              </svg>
            </span>
            <div class="noteText">
              <strong>NOTE</strong> the address must point to <strong>this Streamdelay server</strong>.
            </div>
          </div>
        </div>
      </section>

      <script defer src="/static/js/status.js"></script>
      <script defer src="/static/js/obs.js"></script>
    {% endif %}
  </div>

  <footer>
    <div class="footerInner">
      <div class="footerLeft" aria-label="Theme">
        <div class="dd" id="themeDD">
          <button type="button" class="ddBtn" id="ddBtn" aria-haspopup="true" aria-expanded="false">
            <span class="srOnly">Theme</span>
            <span class="ddLeft">
              <svg class="stateIcon" id="stateIcon" viewBox="0 0 24 24" aria-hidden="true">
                <path fill="currentColor" d="M12 2a10 10 0 1 0 0 20a10 10 0 0 0 0-20Zm0 18a8 8 0 1 1 0-16a8 8 0 0 1 0 16Zm0-12a4 4 0 1 0 0 8a4 4 0 0 0 0-8Z"/>
              </svg>
              <span class="ddTitle">Theme</span>
              <span class="ddState" id="ddState">Auto</span>
            </span>
            <span class="caret" aria-hidden="true">▾</span>
          </button>

          <div class="menu" id="ddMenu" role="menu" aria-label="Theme menu">
            <div class="item" id="mAuto" role="menuitem" tabindex="0">
              <div><b>Auto</b><br><span>Follows system theme</span></div>
              <svg class="check" viewBox="0 0 24 24" aria-hidden="true">
                <path fill="currentColor" d="M9.0 16.2l-3.5-3.5L4 14.2l5 5 11-11-1.5-1.5z"/>
              </svg>
            </div>
            <div class="item" id="mLight" role="menuitem" tabindex="0">
              <div><b>Light</b><br><span>Bright background</span></div>
              <svg class="check" viewBox="0 0 24 24" aria-hidden="true">
                <path fill="currentColor" d="M9.0 16.2l-3.5-3.5L4 14.2l5 5 11-11-1.5-1.5z"/>
              </svg>
            </div>
            <div class="item" id="mDark" role="menuitem" tabindex="0">
              <div><b>Dark</b><br><span>Dim background</span></div>
              <svg class="check" viewBox="0 0 24 24" aria-hidden="true">
                <path fill="currentColor" d="M9.0 16.2l-3.5-3.5L4 14.2l5 5 11-11-1.5-1.5z"/>
              </svg>
            </div>
          </div>
        </div>
      </div>

      <div class="footerRight">
        <a href="https://github.com/marcinmajsc/" target="_blank" rel="noopener" aria-label="GitHub - marcinmajsc">
          <svg width="18" height="18" viewBox="0 0 16 16" aria-hidden="true" focusable="false">
            <path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38
            0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52
            -.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2
            -3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82
            .64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08
            2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01
            1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/>
          </svg>
          marcinmajsc
        </a>
        <div>© <span id="year">2026</span></div>
      </div>
    </div>
  </footer>

  <script defer src="/static/js/theme.js"></script>
  <script defer src="/static/js/pwa.js"></script>
  <script>
    (function(){
      var y = document.getElementById("year");
      if (y) y.textContent = new Date().getFullYear();
    })();
  </script>
</body>
</html>
